  // Sample JSON data - You can modify this to add your tasks
        const tasksData = {
            "monday": {
                "0:00": [
                    { "title": "Dormir", "type": "important", "completed": false }
                ],
                "5:00": [
                    { "title": "Dormir", "type": "important", "completed": false }
                ],
                "6:00": [
                    { "title": "Pasear perros", "type": "leisure", "completed": false },
                    { "title": "Desayunar", "type": "important", "completed": false },
                    { "title": "Lavar dientes", "type": "important", "completed": false },
                    { "title": "Lavar trastes", "type": "important", "completed": false },
                    { "title": "Meditar", "type": "leisure", "completed": false }
                ],
                "7:00": [
                    { "title": "Gym", "type": "leisure", "completed": false }
                ],
                "8:00": [
                    { "title": "Ducharme", "type": "important", "completed": false },
                    { "title": "Hacer del baño", "type": "important", "completed": false },
                    { "title": "Hacer rachas", "type": "important", "completed": false }
                ],
                "9:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "CV WEB", "type": "project", "completed": false }
                ],
                "10:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "CV WEB", "type": "project", "completed": false }
                ],
                "11:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Curso SQL", "type": "university", "completed": false }
                ],
                "12:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Curso SQL", "type": "university", "completed": false }
                ],
                "13:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "CUCEI MART", "type": "project", "completed": false }
                ],
                "14:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Comer", "type": "important", "completed": false },
                    { "title": "Lavar trastes", "type": "important", "completed": false },
                    { "title": "Pasear perritos", "type": "leisure", "completed": false }
                ],
                "15:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "CUCEI MART", "type": "project", "completed": false }

                ],
                "16:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Inceptions", "type": "project", "completed": false }

                ],
                "17:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Inceptions", "type": "project", "completed": false }

                ],
                "18:00": [
                    { "title": "Curso De Guitarra", "type": "important", "completed": false }
                    

                ],
                "19:00": [
                    { "title": "Inceptions", "type": "project", "completed": false }

                ],
                "20:00": [
                    { "title": "Alonso Restaurantes", "type": "leisure", "completed": false }

                ],
                "21:00": [
                    { "title": "Alonso Restaurantes", "type": "leisure", "completed": false }


                ],
                "22:00": [
                    { "title": "Alonso Restaurantes", "type": "leisure", "completed": false }

                ],
                "23:00": [
                    { "title": "Alonso Restaurantes", "type": "leisure", "completed": false },
                    { "title": "Cenar", "type": "important", "completed": false },
                    { "title": "Lavarme los dientes", "type": "important", "completed": false },
                    { "title": "Lavar los trastes", "type": "important", "completed": false },

                ]
            },

            "tuesday": {
                "0:00": [
                    { "title": "Dormir", "type": "important", "completed": false }
                ],
                
                "5:00": [
                    { "title": "Dormir", "type": "important", "completed": false }
                ],
                "6:00": [
                    { "title": "Pasear perros", "type": "leisure", "completed": false },
                    { "title": "Desayunar", "type": "important", "completed": false },
                    { "title": "Lavar dientes", "type": "important", "completed": false },
                    { "title": "Lavar trastes", "type": "important", "completed": false },
                    { "title": "Meditar", "type": "leisure", "completed": false }
                ],
                "7:00": [
                    { "title": "Gym", "type": "leisure", "completed": false }
                ],
                "8:00": [
                    { "title": "Ducharme", "type": "important", "completed": false },
                    { "title": "Hacer del baño", "type": "important", "completed": false },
                    { "title": "Hacer rachas", "type": "important", "completed": false }
                ],
                "9:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "NEXCODE", "type": "project", "completed": false }
                ],
                "10:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "NEXCODE", "type": "project", "completed": false }
                ],
                "11:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Curso SQL", "type": "university", "completed": false }
                ],
                "12:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Curso SQL", "type": "university", "completed": false }
                ],
                "13:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "NEXCODE", "type": "project", "completed": false }
                ],
                "14:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Comer", "type": "important", "completed": false },
                    { "title": "Lavar trastes", "type": "important", "completed": false },
                    { "title": "Pasear perritos", "type": "leisure", "completed": false }
                ],
                "15:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Curso de C", "type": "university", "completed": false }

                ],
                "16:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Curso de C", "type": "university", "completed": false }

                ],
                "17:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Repertorio Guitarra y voz", "type": "project", "completed": false }

                ],
                "18:00": [
                    { "title": "Curso De Voz", "type": "important", "completed": false }


                ],
                "19:00": [
                    { "title": "Inceptions", "type": "project", "completed": false }

                ],
                "20:00": [
                    { "title": "Inceptions", "type": "project", "completed": false }

                ],
                "21:00": [
                    { "title": "Inceptions", "type": "project", "completed": false }

                ],
                "22:00": [
                    { "title": "Cenar", "type": "important", "completed": false },
                    { "title": "Lavarme los dientes", "type": "important", "completed": false },
                    { "title": "Lavar los trastes", "type": "important", "completed": false },
                    { "title": "Inceptions", "type": "project", "completed": false }
                ],
                "23:00": [
                    { "title": "Inceptions", "type": "project", "completed": false }
                ]
            },

            "wednesday": {
                 "0:00": [
                    { "title": "Dormir", "type": "important", "completed": false }
                ],
                
                "5:00": [
                    { "title": "Dormir", "type": "important", "completed": false }
                ],
                "6:00": [
                    { "title": "Pasear perros", "type": "leisure", "completed": false },
                    { "title": "Desayunar", "type": "important", "completed": false },
                    { "title": "Lavar dientes", "type": "important", "completed": false },
                    { "title": "Lavar trastes", "type": "important", "completed": false },
                    { "title": "Meditar", "type": "leisure", "completed": false }
                ],
                "7:00": [
                    { "title": "Gym", "type": "leisure", "completed": false }
                ],
                "8:00": [
                    { "title": "Ducharme", "type": "important", "completed": false },
                    { "title": "Hacer del baño", "type": "important", "completed": false },
                    { "title": "Hacer rachas", "type": "important", "completed": false }
                ],
                "9:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "CUCEI MART", "type": "project", "completed": false }
                ],
                "10:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "CUCEI MART", "type": "project", "completed": false }
                ],
                "11:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Curso SQL", "type": "university", "completed": false }
                ],
                "12:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Curso SQL", "type": "university", "completed": false }
                ],
                "13:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "CUCEI MART", "type": "project", "completed": false }
                ],
                "14:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Comer", "type": "important", "completed": false },
                    { "title": "Lavar trastes", "type": "important", "completed": false },
                    { "title": "Pasear perritos", "type": "leisure", "completed": false }
                ],
                "15:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "CUCEI MART", "type": "project", "completed": false }

                ],
                "16:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Inceptions", "type": "project", "completed": false }

                ],
                "17:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Inceptions", "type": "project", "completed": false }

                ],
                "18:00": [
                    { "title": "Curso De Guitarra", "type": "important", "completed": false }

                ],
                "19:00": [
                    { "title": "Inceptions", "type": "project", "completed": false }

                ],
                "20:00": [
                    { "title": "Composicion, Luis o Alonso", "type": "leisure", "completed": false }

                ],
                "21:00": [
                    { "title": "Composicion, Luis o Alonso", "type": "leisure", "completed": false }

                ],
                "22:00": [
                    { "title": "Composicion", "type": "leisure", "completed": false }
                ],
                "23:00": [
                    { "title": "Composicion, Luis o Alonso", "type": "leisure", "completed": false },
                    { "title": "Cenar", "type": "important", "completed": false },
                    { "title": "Lavarme los dientes", "type": "important", "completed": false },
                    { "title": "Lavar los trastes", "type": "important", "completed": false },
                ]
            },
            "thursday": {
                 "0:00": [
                    { "title": "Dormir", "type": "important", "completed": false }
                ],
                
                "5:00": [
                    { "title": "Dormir", "type": "important", "completed": false }
                ],
                "6:00": [
                    { "title": "Pasear perros", "type": "leisure", "completed": false },
                    { "title": "Desayunar", "type": "important", "completed": false },
                    { "title": "Lavar dientes", "type": "important", "completed": false },
                    { "title": "Lavar trastes", "type": "important", "completed": false },
                    { "title": "Meditar", "type": "leisure", "completed": false }
                ],
                "7:00": [
                    { "title": "Gym", "type": "leisure", "completed": false }
                ],
                "8:00": [
                    { "title": "Ducharme", "type": "important", "completed": false },
                    { "title": "Hacer del baño", "type": "important", "completed": false },
                    { "title": "Hacer rachas", "type": "important", "completed": false }
                ],
                "9:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "NEXCODE", "type": "project", "completed": false }
                ],
                "10:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "NEXCODE", "type": "project", "completed": false }
                ],
                "11:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Curso SQL", "type": "university", "completed": false }
                ],
                "12:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Curso SQL", "type": "university", "completed": false }
                ],
                "13:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "NEXCODE", "type": "project", "completed": false }
                ],
                "14:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Comer", "type": "important", "completed": false },
                    { "title": "Lavar trastes", "type": "important", "completed": false },
                    { "title": "Pasear perritos", "type": "leisure", "completed": false }
                ],
                "15:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Curso de C", "type": "university", "completed": false }

                ],
                "16:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Curso de C", "type": "university", "completed": false }

                ],
                "17:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Inceptions", "type": "project", "completed": false }

                ],
                "18:00": [
                    { "title": "Curso De Voz", "type": "important", "completed": false }

                ],
                "19:00": [
                    { "title": "Farid", "type": "leisure", "completed": false }

                ],
                "20:00": [
                    { "title": "Ensayar", "type": "leisure", "completed": false }

                ],
                "21:00": [
                    { "title": "Ensayar", "type": "leisure", "completed": false }

                ],
                "22:00": [
                    { "title": "Ensayar", "type": "leisure", "completed": false }
                ],
                "23:00": [
                    { "title": "Ensayar", "type": "leisure", "completed": false },
                    { "title": "Cenar", "type": "important", "completed": false },
                    { "title": "Lavarme los dientes", "type": "important", "completed": false },
                    { "title": "Lavar los trastes", "type": "important", "completed": false },
                ]
            },
            "friday": {
                 "0:00": [
                    { "title": "Dormir", "type": "important", "completed": false }
                ],
                
                "5:00": [
                    { "title": "Dormir", "type": "important", "completed": false }
                ],
                "6:00": [
                    { "title": "Pasear perros", "type": "leisure", "completed": false },
                    { "title": "Desayunar", "type": "important", "completed": false },
                    { "title": "Lavar dientes", "type": "important", "completed": false },
                    { "title": "Lavar trastes", "type": "important", "completed": false },
                    { "title": "Meditar", "type": "leisure", "completed": false }
                ],
                "7:00": [
                    { "title": "Gym", "type": "leisure", "completed": false }
                ],
                "8:00": [
                    { "title": "Ducharme", "type": "important", "completed": false },
                    { "title": "Hacer del baño", "type": "important", "completed": false },
                     { "title": "Hacer rachas", "type": "important", "completed": false }
                ],
                "9:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Youtube", "type": "project", "completed": false }
                ],
                "10:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Youtube", "type": "project", "completed": false }

                ],
                "11:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Youtube", "type": "project", "completed": false }

                ],
                "12:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Youtube", "type": "project", "completed": false }

                ],
                "13:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Youtube", "type": "project", "completed": false }

                ],
                "14:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Comer", "type": "important", "completed": false },
                    { "title": "Lavar trastes", "type": "important", "completed": false },
                    { "title": "Pasear perritos", "type": "leisure", "completed": false },
                    { "title": "Youtube", "type": "project", "completed": false }

                ],
                "15:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Youtube", "type": "project", "completed": false }

                ],
                "16:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Youtube", "type": "project", "completed": false }

                ],
                "17:00": [
                    { "title": "Derevo", "type": "work", "completed": false },
                    { "title": "Youtube", "type": "project", "completed": false }

                ],
                "18:00": [
                    { "title": "Curso De Guitarra", "type": "important", "completed": false }

                ],
                 "19:00": [
                    { "title": "Curso Composicion Dery", "type": "leisure", "completed": false }
                ],
                 "20:00": [
                    { "title": "Curso Composicion Dery", "type": "leisure", "completed": false }
                ],
                 "21:00": [
                    { "title": "Curso Composicion Dery", "type": "leisure", "completed": false },
                    { "title": "Alonso Restaurantes", "type": "leisure", "completed": false }
                ],
                "22:00": [
                    { "title": "Alonso Restaurantes", "type": "leisure", "completed": false }
                ],
                "23:00": [
                    { "title": "Alonso Restaurantes", "type": "leisure", "completed": false },
                    { "title": "Cenar", "type": "important", "completed": false },
                    { "title": "Lavarme los dientes", "type": "important", "completed": false },
                    { "title": "Lavar los trastes", "type": "important", "completed": false }
                ]
            },
            "saturday": {
                 "0:00": [
                    
                ],
            },
            "sunday": {
                 "0:00": [
                    
                ],
            },

        };

        class Calendar {
            constructor() {
                this.days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
                this.hours = this.generateHours();
                this.completedTasks = this.loadCompletedTasks();
                this.init();
            }

            generateHours() {
                const hours = [];
                for (let i = 0; i < 24; i++) {
                    const hour12 = i === 0 ? 12 : i > 12 ? i - 12 : i;
                    const ampm = i < 12 ? 'AM' : 'PM';
                    const displayHour = `${hour12}:00 ${ampm}`;
                    const dataHour = `${i}:00`;
                    hours.push({ display: displayHour, data: dataHour });
                }
                return hours;
            }

            loadCompletedTasks() {
                const saved = localStorage.getItem('completedTasks');
                return saved ? JSON.parse(saved) : {};
            }

            saveCompletedTasks() {
                localStorage.setItem('completedTasks', JSON.stringify(this.completedTasks));
            }

            init() {
                this.generateCalendar();
                this.updateProgress();
                this.setupThemeSelector();
                this.loadTheme();
            }

            generateCalendar() {
                const calendarBody = document.getElementById('calendar-body');
                calendarBody.innerHTML = '';

                this.hours.forEach(hour => {
                    // Time slot
                    const timeSlot = document.createElement('div');
                    timeSlot.className = 'time-slot';
                    timeSlot.textContent = hour.display;
                    calendarBody.appendChild(timeSlot);

                    // Day columns
                    this.days.forEach(day => {
                        const dayColumn = document.createElement('div');
                        dayColumn.className = 'day-column';
                        
                        const tasks = tasksData[day] && tasksData[day][hour.data];
                        if (tasks) {
                            tasks.forEach((task, index) => {
                                const taskElement = this.createTaskElement(task, day, hour.data, index);
                                dayColumn.appendChild(taskElement);
                            });
                        }

                        calendarBody.appendChild(dayColumn);
                    });
                });
            }

            createTaskElement(task, day, hour, index) {
                const taskElement = document.createElement('div');
                const taskId = `${day}-${hour}-${index}`;
                const isCompleted = this.completedTasks[taskId] || task.completed;
                
                taskElement.className = `task task-${task.type} ${isCompleted ? 'completed' : ''}`;
                taskElement.innerHTML = `
                    <span>${task.title}</span>
                    <input type="checkbox" class="task-checkbox" ${isCompleted ? 'checked' : ''} 
                           data-task-id="${taskId}">
                `;

                taskElement.querySelector('.task-checkbox').addEventListener('change', (e) => {
                    this.toggleTask(taskId, e.target.checked);
                });

                return taskElement;
            }

            toggleTask(taskId, completed) {
                if (completed) {
                    this.completedTasks[taskId] = true;
                } else {
                    delete this.completedTasks[taskId];
                }
                
                this.saveCompletedTasks();
                this.generateCalendar();
                this.updateProgress();
            }

            updateProgress() {
                const today = new Date().getDay();
                const todayKey = this.days[today === 0 ? 6 : today - 1]; // Adjust for Sunday = 0
                
                // Daily progress
                let dailyTotal = 0;
                let dailyCompleted = 0;
                
                if (tasksData[todayKey]) {
                    Object.values(tasksData[todayKey]).forEach(hourTasks => {
                        dailyTotal += hourTasks.length;
                        hourTasks.forEach((task, index) => {
                            const taskId = `${todayKey}-${Object.keys(tasksData[todayKey])[Object.values(tasksData[todayKey]).indexOf(hourTasks)]}-${index}`;
                            if (this.completedTasks[taskId] || task.completed) {
                                dailyCompleted++;
                            }
                        });
                    });
                }

                // Weekly progress
                let weeklyTotal = 0;
                let weeklyCompleted = 0;
                
                this.days.forEach(day => {
                    if (tasksData[day]) {
                        Object.entries(tasksData[day]).forEach(([hour, hourTasks]) => {
                            weeklyTotal += hourTasks.length;
                            hourTasks.forEach((task, index) => {
                                const taskId = `${day}-${hour}-${index}`;
                                if (this.completedTasks[taskId] || task.completed) {
                                    weeklyCompleted++;
                                }
                            });
                        });
                    }
                });

                const dailyPercentage = dailyTotal > 0 ? Math.round((dailyCompleted / dailyTotal) * 100) : 0;
                const weeklyPercentage = weeklyTotal > 0 ? Math.round((weeklyCompleted / weeklyTotal) * 100) : 0;

                document.getElementById('daily-progress').style.width = `${dailyPercentage}%`;
                document.getElementById('daily-progress').textContent = `${dailyPercentage}%`;
                document.getElementById('daily-stats').textContent = `${dailyCompleted} de ${dailyTotal} tareas completadas hoy`;

                document.getElementById('weekly-progress').style.width = `${weeklyPercentage}%`;
                document.getElementById('weekly-progress').textContent = `${weeklyPercentage}%`;
                document.getElementById('weekly-stats').textContent = `${weeklyCompleted} de ${weeklyTotal} tareas completadas esta semana`;
            }

            setupThemeSelector() {
                const themeToggle = document.getElementById('theme-toggle');
                const themeDropdown = document.getElementById('theme-dropdown');
                const themeOptions = document.querySelectorAll('.theme-option');

                themeToggle.addEventListener('click', (e) => {
                    e.preventDefault();
                    themeDropdown.classList.toggle('active');
                });

                document.addEventListener('click', (e) => {
                    if (!themeToggle.contains(e.target) && !themeDropdown.contains(e.target)) {
                        themeDropdown.classList.remove('active');
                    }
                });

                themeOptions.forEach(option => {
                    option.addEventListener('click', () => {
                        const theme = option.getAttribute('data-theme');
                        this.setTheme(theme);
                        themeDropdown.classList.remove('active');
                    });
                });
            }

            setTheme(theme) {
                document.body.className = `theme-${theme}`;
                localStorage.setItem('selectedTheme', theme);
            }

            loadTheme() {
                const savedTheme = localStorage.getItem('selectedTheme') || 'purple';
                this.setTheme(savedTheme);
            }
        }

        // Initialize calendar when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new Calendar();
        });





















     // Datos financieros iniciales
        let financialData = {
            totalWealth: 15264.96, // 9,151.74 banco + 1,500 efectivo + 2,612 cetes
            bankBalance: 9151.74, //Banco
            cashBalance: 1468.00, // Efectivo
            cetesBalance: 4645.22,  // CETES
            savings: 5394.90, // Ahorros (50% de nómina)
            investments: 4645.22, // Inversiones (30% de nómina)
            expenses: 69345.18, // Gastos (20% de nómina)
            transactions: [
                {   
                    date: '2025-06-20',
                    amount: 614,
                    description: 'Restaurantes Alonso',
                    type: 'income'
                },
                {   
                    date: '2025-06-20',
                    amount: 424.62,
                    description: 'Ark Survival Evolved',
                    type: 'expense'
                },
                {   
                    date: '2025-06-20',
                    amount: 1245,
                    description: 'Cursos Udemy(Piano, Violin, Canto, Bateria, Guitarra)',
                    type: 'expense'
                },
                {   
                    date: '2025-06-20',
                    amount: 4371.62,
                    description: 'Camara Profesional',
                    type: 'expense'
                },
            ],
            lastPaymentDate: new Date('2025-06-15'), // Fecha de último pago
            paymentAmount: 3000
        };
        // Cargar datos del localStorage si existen
        function loadData() {
            const saved = localStorage.getItem('financialData');
            if (saved) {
                const parsedData = JSON.parse(saved);
                financialData = { ...financialData, ...parsedData };
                // Convertir fechas de string a Date
                if (parsedData.lastPaymentDate) {
                    financialData.lastPaymentDate = new Date(parsedData.lastPaymentDate);
                }
                financialData.transactions = parsedData.transactions || [];
            }
        }
        // Guardar datos en localStorage
        function saveData() {
            localStorage.setItem('financialData', JSON.stringify(financialData));
        }

         // Borrar LocalStorage;
         localStorage.clear()



        // Formatear números como moneda
        function formatCurrency(amount) {
            return `$${amount.toLocaleString('es-MX', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
        }
        // Obtener datos del mercado
        async function fetchMarketData() {
            try {
                // USD/MXN
                const usdResponse = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
                const usdData = await usdResponse.json();
                document.getElementById('usd-rate').textContent = `$${usdData.rates.MXN.toFixed(2)}`;
            } catch (error) {
                document.getElementById('usd-rate').textContent = '$20.15';
            }
            try {
                // Bitcoin
                const btcResponse = await fetch('https://api.coindesk.com/v1/bpi/currentprice.json');
                const btcData = await btcResponse.json();
                const btcPrice = btcData.bpi.USD.rate_float;
                document.getElementById('btc-rate').textContent = `$${(btcPrice * 20.15 / 1000).toFixed(0)}k`;
            } catch (error) {
                document.getElementById('btc-rate').textContent = '$1,400k';
            }
            // CETES (simulado)
            document.getElementById('cetes-rate').textContent = '10.25%';
        }
        // Calcular días hasta el próximo pago
        function calculateNextPayment() {
            const today = new Date();
            const lastPayment = new Date(financialData.lastPaymentDate);
            // Calcular próxima fecha de pago (cada 15 días)
            const nextPayment = new Date(lastPayment);
            nextPayment.setDate(lastPayment.getDate() + 15);
            // Si ya pasó, calcular el siguiente
            while (nextPayment <= today) {
                nextPayment.setDate(nextPayment.getDate() + 15);
            }
            const timeDiff = nextPayment - today;
            const daysDiff = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
            document.getElementById('next-payment-countdown').textContent = 
                `${daysDiff} días (${nextPayment.toLocaleDateString('es-MX')})`;
            // Auto-pago si es el día
            if (daysDiff === 0) {
                processPayroll();
            }
        }
        // Procesar nómina automática
        function processPayroll() {
            const payrollAmount = financialData.paymentAmount;
            
            // Aplicar regla 50-30-20
            const savingsAmount = payrollAmount * 0.5;
            const investmentAmount = payrollAmount * 0.3;
            const expensesAmount = payrollAmount * 0.2;
            financialData.totalWealth += payrollAmount;
            financialData.savings += savingsAmount;
            financialData.investments += investmentAmount;
            financialData.expenses += expensesAmount;
            const today = new Date().toISOString().split('T')[0];
            financialData.transactions.push({
                date: today,
                amount: savingsAmount,
                description: 'Nómina - Ahorros (50%)',
                type: 'income'
            });
            financialData.transactions.push({
                date: today,
                amount: investmentAmount,
                description: 'Nómina - Inversiones (30%)',
                type: 'investment'
            });
            financialData.transactions.push({
                date: today,
                amount: expensesAmount,
                description: 'Nómina - Gastos (20%)',
                type: 'income'
            });
            financialData.lastPaymentDate = new Date();
            saveData();
            updateDisplay();
        }
        function addTransaction() {
            const amount = parseFloat(document.getElementById('amount').value);
            const description = document.getElementById('description').value;
            const type = document.getElementById('type').value;
            if (!amount || !description) {
                alert('Por favor completa todos los campos');
                return;
            }
            const transaction = {
                date: new Date().toISOString().split('T')[0],
                amount: Math.abs(amount),
                description: description,
                type: type
            };
            financialData.transactions.push(transaction);
            if (type === 'expense') {
                financialData.totalWealth -= amount;
                financialData.expenses += amount;
            } else if (type === 'income') {
                financialData.totalWealth += amount;
            } else if (type === 'investment') {
                financialData.investments += amount;
            }
            document.getElementById('amount').value = '';
            document.getElementById('description').value = '';
            
            saveData();
            updateDisplay();
        }
        function updateDisplay() {
            document.getElementById('total-wealth').textContent = formatCurrency(financialData.totalWealth);
            document.getElementById('savings-amount').textContent = formatCurrency(financialData.savings);
            document.getElementById('investment-amount').textContent = formatCurrency(financialData.investments);
            document.getElementById('expenses-amount').textContent = formatCurrency(financialData.expenses);
            
            updateTransactionList();
            updateCharts();
        }

        function updateTransactionList() {
            const list = document.getElementById('transaction-list');
            list.innerHTML = '';
            
            const recentTransactions = financialData.transactions.slice(-10).reverse();
            recentTransactions.forEach(transaction => {
                const item = document.createElement('div');
                item.className = `transaction-item ${transaction.type}`;
                item.innerHTML = `
                    <div class="transaction-info">
                        <div class="transaction-amount">${formatCurrency(transaction.amount)}</div>
                        <div class="transaction-description">${transaction.description}</div>
                        <div class="transaction-date">${new Date(transaction.date).toLocaleDateString('es-MX')}</div>
                    </div>
                `;
                list.appendChild(item);
            });
        }
        let wealthChart, transactionsChart;
        function updateCharts() {
            const wealthCtx = document.getElementById('wealth-chart').getContext('2d');
            
            if (wealthChart) {
                wealthChart.destroy();
            }
            wealthChart = new Chart(wealthCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Banco', 'Efectivo', 'CETES', 'Ahorros', 'Gastos'],
                    datasets: [{
                        data: [
                            financialData.bankBalance,
                            financialData.cashBalance,
                            financialData.cetesBalance,
                            financialData.savings,
                            financialData.expenses
                        ],
                        backgroundColor: [
                            '#667eea',
                            '#764ba2',
                            '#f093fb',
                            '#4facfe',
                            '#f5576c'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            const transCtx = document.getElementById('transactions-chart').getContext('2d');
            if (transactionsChart) {
                transactionsChart.destroy();
            }
            const last30Days = financialData.transactions.slice(-30);
            const dates = last30Days.map(t => new Date(t.date).toLocaleDateString('es-MX'));
            const amounts = last30Days.map(t => t.type === 'expense' ? -t.amount : t.amount);
            transactionsChart = new Chart(transCtx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Flujo de Efectivo',
                        data: amounts,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            updateDisplay();
            fetchMarketData();
            calculateNextPayment();
            setInterval(calculateNextPayment, 3600000);
            setInterval(fetchMarketData, 300000);
        });
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && e.target.closest('.transaction-form')) {
                addTransaction();
            }
        });





// Funcionalidad del Panel de Tareas Importantes
        const tasksBtn = document.getElementById('tasks-btn');
        const tasksOverlay = document.getElementById('important-tasks-overlay');
        const closeTasksBtn = document.getElementById('close-tasks-btn');
        const tasksListContainer = document.getElementById('important-tasks-list');
        const emptyState = document.getElementById('empty-state');

        // Abrir panel de tareas
        tasksBtn.addEventListener('click', (e) => {
            e.preventDefault();
            tasksOverlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        });

        // Cerrar panel de tareas
        function closeTasksPanel() {
            tasksOverlay.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        closeTasksBtn.addEventListener('click', closeTasksPanel);

        // Cerrar al hacer clic en el overlay
        tasksOverlay.addEventListener('click', (e) => {
            if (e.target === tasksOverlay) {
                closeTasksPanel();
            }
        });

        // Cerrar con la tecla Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && tasksOverlay.classList.contains('active')) {
                closeTasksPanel();
            }
        });

        // Array para almacenar las tareas importantes
        let importantTasks = [
   
            {
                id: 1,
                title: "Entregar proyecto final",
                dueDate: "2024-12-20",
                completed: false
            }
        ];

        // Función para agregar una nueva tarea importante
        function addImportantTask(title, dueDate) {
            const newTask = {
                id: Date.now(),
                title: title,
                dueDate: dueDate,
                completed: false
            };
            importantTasks.push(newTask);
            renderTasks();
        }

        // Función para eliminar una tarea importante
        function removeImportantTask(taskId) {
            importantTasks = importantTasks.filter(task => task.id !== taskId);
            renderTasks();
        }

        // Función para marcar/desmarcar tarea como completada
        function toggleTaskCompletion(taskId) {
            const task = importantTasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                renderTasks();
            }
        }

        // Función para determinar el estado de la fecha
        function getDateStatus(dueDate) {
            const today = new Date();
            const due = new Date(dueDate);
            const diffTime = due - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            if (diffDays < 0) return 'overdue';
            if (diffDays <= 3) return 'due-soon';
            return 'normal';
        }

        // Función para renderizar las tareas
        function renderTasks() {
            if (importantTasks.length === 0) {
                tasksListContainer.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }

            tasksListContainer.style.display = 'flex';
            emptyState.style.display = 'none';

            // Ordenar tareas por fecha de entrega
            const sortedTasks = [...importantTasks].sort((a, b) => {
                if (a.completed && !b.completed) return 1;
                if (!a.completed && b.completed) return -1;
                return new Date(a.dueDate) - new Date(b.dueDate);
            });

            tasksListContainer.innerHTML = sortedTasks.map(task => {
                const dateStatus = getDateStatus(task.dueDate);
                const dateFormatted = new Date(task.dueDate).toLocaleDateString('es-ES', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });

                return `
                    <div class="important-task-item ${task.completed ? 'completed' : ''}" data-task-id="${task.id}">
                        <div class="task-checkbox-container">
                            <div class="task-checkbox ${task.completed ? 'checked' : ''}" onclick="toggleTaskCompletion(${task.id})"></div>
                            <div class="task-content">
                                <div class="task-title">${task.title}</div>
                                <div class="task-date ${dateStatus}">
                                    <i class="fas fa-calendar-alt"></i>
                                    ${dateFormatted}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }